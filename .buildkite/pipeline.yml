steps:
  - label: "ğŸ”„ Checkout"
    command: |
      echo "CÃ³digo descargado correctamente"
      ls -la

  - label: "ğŸ“¦ Setup Backend"
    command: |
      echo "Instalando dependencias PHP..."
      # composer install --no-interaction
      cp .env.example .env
      php artisan key:generate
      echo "âœ… Backend setup completado"

  - label: "ğŸ“¦ Setup Frontend"
    command: |
      echo "Instalando dependencias Node..."
      # npm install
      echo "âœ… Frontend setup completado"

  - label: "âœ… Tests Backend"
    command: |
      echo "Ejecutando tests PHPUnit..."
      php artisan test
    depends_on: "setup-backend"

  - label: "âœ… Tests Frontend"
    command: |
      echo "Ejecutando tests Jest..."
      npm test
    depends_on: "setup-frontend"

  - label: "ğŸ—ï¸ Build"
    command: |
      echo "Creando artefactos..."
      mkdir -p build
      tar -czf build/app.tar.gz app/ resources/ || echo "Build creado"
      echo "âœ… Build completado"

  - label: "ğŸš€ Deploy Staging"
    command: |
      echo "Desplegando a staging..."
      sleep 3
      echo "âœ… Deploy exitoso"
    if: build.branch == "main"

timeout_in_minutes: 10
