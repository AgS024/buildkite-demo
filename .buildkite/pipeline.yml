steps:
  - label: "ðŸ”„ Checkout"
    command: |
      echo "CÃ³digo descargado correctamente"
      ls -la

  - label: "ðŸ“¦ Setup + Tests Backend"
    id: "backend"
    command: |
      echo "Instalando dependencias PHP..."
      cp .env.example .env
      php -v
      composer install --no-interaction --no-progress
      echo "âœ… Dependencias PHP instaladas"
      echo "Ejecutando tests PHPUnit..."
      php artisan test
      echo "âœ… Tests backend completados"

  - label: "ðŸ“¦ Setup + Tests Frontend"
    id: "frontend"
    command: |
      echo "Instalando dependencias Node..."
      node -v
      npm -v
      npm install
      echo "âœ… Dependencias Node instaladas"
      echo "Ejecutando tests Jest..."
      npm test
      echo "âœ… Tests frontend completados"

  - label: "ðŸ—ï¸ Build"
    depends_on:
      - "backend"
      - "frontend"
    command: |
      echo "Creando artefactos..."
      mkdir -p build
      tar -czf build/app.tar.gz public app builds composer.json package.json .env 2>/dev/null
      echo "âœ… Build completado (build/app.tar.gz)"

  - label: "ðŸš€ Deploy Staging"
    command: |
      echo "Desplegando a staging (simulado)..."
      sleep 3
      echo "âœ… Deploy exitoso"
    if: build.branch == "main"

timeout_in_minutes: 15
